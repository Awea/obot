#!/usr/bin/env ruby

require 'thor'

class ObotCLI < Thor

  option :config_file
  option :env
  desc 'default_loop', 'run the default_loop'
  def default_loop
    require_relative '../lib/loop'
    require_relative '../lib/browser'
    require_relative '../lib/database'
    require_relative '../lib/obot'

    obot = Obot.new(
      options[:config_file] ? options[:config_file] : 'config/config.yml',
      options[:env]         ? options[:env] : 'development'
    )
    Loop.new(obot).run_default
  end

  desc 'build_at planet_coordinates, type, at', 'Add a build order for a given planet at a given time'
  def build_at(planet_coordinates, type, at)
    require_relative '../lib/database'

    `echo "/Users/aweaoftheworld/.in-progress/obot/bin/cli do_build '#{planet_coordinates}' '#{type}'" | at #{at}`
  end

  desc 'do_build planet_coordinates, type', 'Write the order for the next loop'
  def do_build(planet_coordinates, type)
    require_relative '../lib/database'

    BuildLoop.new(planet_coordinates, type).save
  end
end

ObotCLI.start(ARGV)
